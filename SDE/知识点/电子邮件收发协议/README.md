# 电子邮件收发协议

> 电子邮件协议有SMTP、POP3、IMAP4，它们都隶属于TCP/IP协议簇，默认状态下，分别通过TCP端口25、110和143建立连接。而电子邮件通常采用的传输协议是SMTP。

## SMTP协议

SMTP的全称是“Simple Mail Transfer Protocol”，即简单邮件传输协议，是一种提供可靠且有效的电子邮件传输的协议。SMTP是建立在FTP (File Transfer Protocol) 文件传输服务上的一种邮件服务，主要用于系统之间的邮件信息传递，并提供有关来信的通知。

SMTP独立于特定的传输子系统，且只需要可靠有序的数据流信道支持，SMTP的重要特性之一是其能跨越网络传输邮件，即“SMTP邮件中继”。

使用SMTP，可实现相同网络处理进程之间的邮件传输，也可通过中继器或网关实现某处理进程与其他网络之间的邮件传输。

#### 功能：

SMTP是一组用于从源地址到目的地址传送邮件的规则，并且控制信件的中转方式。SMTP协议属于TCP/IP协议族，它帮助每台计算机在发送或中转信件时找到下一个目的地。通过SMTP协议所指定的服务器，我们就可以把E—mail寄到收信人的服务器上了，整个过程只需要几分钟。SMTP服务器是遵循SMTP协议的发送邮件服务器，用来发送或中转用户发出的电子邮件。

SMTP是一种提供可靠且有效电子邮件传输的协议。它是建立在FTP文件传输服务上的一种邮件服务，主要用于传输系统之间的邮件信息并提供来信有关的通知。

SMTP重要的特性之一是它能跨越网络传输邮件，也即“SMTP邮件中继”。使用SMTP，可实现相同网络上处理机之间的邮件传输，也可以通过中继器或网关实现某处理机与其它网络之间的邮件传输。具有域名服务系统(DNS)功能的邮件交换服务器还可以用来识别出传输邮件的下一跳IP地址。

#### 工作过程

SMTP协议的工作过程可分为如下3个过程：

(1)建立连接：在这一阶段，SMTP客户请求与服务器的25端口建立一个TCP连接。一旦连接建立，SMTP服务器和客户就开始相互通告自己的域名，同时确认对方的域名。

(2)邮件传送：利用命令，SMTP客户将邮件的源地址、目的地址和邮件的具体内容传递给SMTP服务器，SMTP服务器进行相应的响应并接收邮件。

(3)连接释放：SMTP客户发出退出命令，服务器在处理命令后进行响应，随后关闭TCP连接。

#### 收取邮件协议产生的背景
在Internet上使用电子邮件的早期，用户如果要读取邮件，必须先登录到邮件服务器上，不但速度慢，而且这些邮件服务器基于文本，没有友好的界面，使用不便。于是出现了一些邮件协议，可以使邮件消息直接发送到用户自己的计算机上。在这些协议中使用最为广泛的就是POP（Post Office Protocol，邮局协议）和IMAP（Internet Mail Access Protocol，互联网邮件控制协议）。

**POP是TCP/IP协议族中的一员**，POP允许本地计算机上的用户代理程序连接到邮件服务器，将用户的邮件取回到本地，这样用户就能在本地阅读邮件了。本协议主要用于支持使用客户端远程管理在服务器上的电子邮件。

创建一个分布式电子邮件系统有多种不同的技术支持和途径：POP（邮局协议）、DMSP（分层式电子邮件系统协议）和 IMAP（因特网信息访问协议）。其中，POP 协议创建最早因此也最为人们了解；DMSP 具有较好的支持“无连接”操作的性能，但其很大程度上仅限于单个应用程序（PCMAIL）；IMAP 提供了 POP 和 DMSP 的扩展集并提供对远程邮件访问的三种支持方式：**离线、在线和无连接**。

POP 协议支持“离线”邮件处理。其具体过程是：邮件发送到服务器上，电子邮件客户端调用邮件客户机程序以连接服务器，并下载所有未阅读的电子邮件。这种离线访问模式是一种存储转发服务，将邮件从邮件服务器端送到个人终端机器上，一般是 PC 机或 MAC。一旦邮件发送到 PC 机或 MAC 上，邮件服务器上的邮件将会被删除。

POP诞生于1984年，POP 协议允许工作站动态访问服务器上的邮件，目前已发展到第三版，称为POP3（Post Office ProtocolVersion 3，邮局协议第3版），由RFC 1939 定义 。

POP3 传输的是数据消息，这些消息可以是指令，也可以是应答。POP3 使用 TCP 作为传输协议，使用TCP的110号端口工作，它规定怎样将个人计算机连接到Internet的邮件服务器和下载电子邮件的电子协议。POP3允许用户从服务器上把邮件存储到本地主机（即自己的计算机）上，同时删除保存在邮件服务器上的邮件，而POP3服务器则是遵循POP3协议的接收邮件服务器，用来接收电子邮件的。

POP3 并不支持对服务器上邮件进行扩展操作，此过程由更高级的 IMAP4 完成。

## POP协议

POP邮局协议负责从邮件服务器中检索电子邮件。它要求邮件服务器完成下面几种任务之一：从邮件服务器中检索邮件并从服务器中删除这个邮件；从邮件服务器中检索邮件但不删除它；不检索邮件，只是询问是否有新邮件到达。POP协议支持多用户互联网邮件扩展，后者允许用户在电子邮件上附带二进制文件，如文字处理文件和电子表格文件等，实际上这样就可以传输任何格式的文件了，包括图片和声音文件等。在用户阅读邮件时，POP命令所有的邮件信息立即下载到用户的计算机上，不在服务器上保留。

POP3(Post Office Protocol 3)即邮局协议的第3个版本,是因特网电子邮件的第一个离线协议标准。

## IMAP协议

IMAP（Internet Message Access Protocol）以前称作交互邮件访问协议（Interactive Mail Access Protocol），是一个应用层协议。IMAP是斯坦福大学在1986年开发的一种邮件获取协议。它的主要作用是邮件客户端可以通过这种协议从邮件服务器上获取邮件的信息，下载邮件等。当前的权威定义是RFC3501。IMAP协议运行在TCP/IP协议之上，使用的端口是143。它与POP3协议的主要区别是用户可以不用把所有的邮件全部下载，可以通过客户端直接对服务器上的邮件进行操作。

互联网信息访问协议（IMAP）是一种优于POP的新协议。和POP一样，IMAP也能下载邮件、从服务器中删除邮件或询问是否有新邮件，但IMAP克服了POP的一些缺点。例如，它可以决定客户机请求邮件服务器提交所收到邮件的方式，请求邮件服务器只下载所选中的邮件而不是全部邮件。客户机可先阅读邮件信息的标题和发送者的名字再决定是否下载这个邮件。通过用户的客户机电子邮件程序，IMAP可让用户在服务器上创建并管理邮件文件夹或邮箱、删除邮件、查询某封信的一部分或全部内容，完成所有这些工作时都不需要把邮件从服务器下载到用户的个人计算机上。

支持种IMAP的常用邮件客户端有：ThunderMail,Foxmail,Microsoft Outlook等。

#### 参考
[邮局协议POP](https://baike.baidu.com/item/POP)
[电子邮件通常采用的传输协议是什么](https://www.php.cn/faq/493772.html)
